# Heavy Hitters

Этот репозиторий содержит реализации вероятностных структур данных heavy hitters на Go.

## Что такое Heavy Hitters?

Heavy Hitters — это класс алгоритмов для идентификации наиболее часто встречающихся элементов в потоке данных.
Они решают задачу эффективного поиска элементов, чья частота превышает заданный порог, с минимальным использованием вычислительных ресурсов и памяти.

## Реализованные алгоритмы

* [Space-Saving](spacesaving) - отслеживает ограниченное число элементов, заменяя наименее вероятные кандидаты при переполнении.
* [Misra-Gries](misragries) - предоставляет приближенное решение, используя фиксированное количество счетчиков и обеспечивая гарантированную точность для элементов с высокой частотой.
* [Lossy Counting](lossy) - постепенно уменьшает веса счетчиков, позволяя эффективно идентифицировать частые элементы в бесконечных потоках данных с контролируемой погрешностью.

## Особенности реализации

Все структуры разработаны с учётом работы в высоконагруженных многопоточных средах:

* Шардирование на основе хэшей элементов для уменьшения contention
* Минимизация потребления памяти/аллокаций

### Инициализация

Каждая пакет содержит структуру `Config`, позволяющую гибко настроить структуру.
Пример [`Config`](spacesaving/config.go). Общим у конфигов является возможность задать:

* Нужную хэш-функцию (обязательный параметр)
* Количество счётчиков или рамки допустимой погрешности (обязательный параметр)
* Количество шардов (необязательный параметр, по умолчанию 4)
* Параметр [`MetricsWriter`](metrics.go) для записи метрик

### Единый интерфейс

Все реализации соответствуют единому интерфейсу [`Hitter`](interface.go), который позволяет:

* Добавлять элемент
* Получить оценку частот топовых элементов

Это позволяет легко заменять одну структуру на другую без изменения кода приложения и даёт гибкость в выборе
оптимального алгоритма для конкретной задачи.

### Мониторинг и метрики

Структура `Config` позволяет передать реализацию [`MetricsWriter`](metrics.go), которая будет писать метрики:

* Сколько элементов добавлено
* Гистограмму частот элементов

Применение метрик позволяет решить проблему "чёрного ящика", всегда можно оценить насколько эффективно структура
справляется с задачей и при необходимости настроить её более оптимально.

Имеется коробочная реализация [Prometheus](../metrics/prometheus/heavy.go) TSDB. При необходимости можно написать
собственную реализацию для своей TSDB (например VictoriaMetrics).

## Области применения

* Анализ сетевого трафика для выявления аномалий
* Обработка поисковых запросов в крупных поисковых системах
* Мониторинг кликов в онлайн-рекламе
* Обнаружение популярных трендов в социальных сетях
* Оптимизация кэширования в базах данных

## Заключение

Реализованные алгоритмы могут быть эффективно применены в высоконагруженных средах для обработки больших потоков данных.
Они обеспечивают баланс между точностью результатов и потреблением ресурсов, что делает их подходящими для
систем реального времени и распределенных вычислений.
