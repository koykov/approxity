# Misra-Gries

Misra-Gries — это вероятностный алгоритм для поиска **частых элементов** (heavy hitters) в потоке данных.
Он решает задачу **приближённого подсчёта** элементов, встречающихся не реже чем $n/k$ раз, где:
- $n$ — общее количество элементов в потоке,
- $k$ — параметр, определяющий точность и потребление памяти.

Алгоритм использует $O(k)$ памяти и гарантирует, что все элементы с частотой $\geq n/k$ будут найдены
(но может возвращать и некоторые элементы с меньшей частотой).

## Особенности реализации

* Поддержка пользовательских хэш-функций
* Шардирование для работы в многопоточной среде
* Коробочное покрытие метриками

## Использование

```go
package main

import (
	"fmt"

	"github.com/koykov/hash/xxhash"
	"github.com/koykov/pbtk/heavy/misragries"
)

const K = 5

func main() {
	hasher := xxhash.Hasher64[[]byte]{}
	hitter, err := misragries.NewHitter[string](misragries.NewConfig(K, hasher))
	_ = err
	oftenKey := "key0"
	for i := 0; i < 1000; i++ {
		key := fmt.Sprintf("key%d", i)
		_ = hitter.Add(key)
		if i%2 == 0 {
			_ = hitter.Add(oftenKey)
		}
	}
	hits := hitter.Hits()
	fmt.Printf("%+v", hits) // [{Key:key0 Rate:242} {Key:key990 Rate:1} {Key:key992 Rate:1} {Key:key999 Rate:1} {Key:key996 Rate:1}]
}
```

## Области применения

Алгоритм Misra-Gries может быть использован в:
1. **Анализе сетевого трафика** — поиск часто встречающихся IP-адресов или URL.
2. **Обработке логов** — выявление популярных запросов или ошибок.
3. **Рекомендательных системах** — обнаружение трендовых товаров или контента.
4. **Потоковой аналитике** — мониторинг аномалий в реальном времени.

## Заключение

Данная реализация алгоритма предоставляет:

* Эффективный поиск частых элементов в потоке данных.  
* Поддержку многопоточности через шардирование.  
* Гибкость с возможностью задания своей хэш-функции.  
* Готовые метрики для оценки качества работы.

Алгоритм особенно полезен в сценариях, где важна скорость и экономия памяти и допустима небольшая погрешность.
